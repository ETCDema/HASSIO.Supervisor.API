# C# клиент для Home Assistant supervisor API

Создан для использования в проектах Home Assistant add-on, работает на текущий момент с WebSocketAPI.

На данный момент реализовано:
1. Подключение к WebSocketAPI
1. Процесс авторизации
1. Получение текущего сосотояния всех entity
1. Запуск отслеживания изменения состояния отдельных entity
1. Переподключение при потере связи

## Как работат

1. При запуске `HASSIOSuperviser.RunAsync` происходит подключение к WebSocketAPI
1. Запускается поток получения сообщений от WebSocketAPI и добавление в очередь на обработку
1. Запускается поток обработки очереди
1. Выполняется обработка запроса авторизации
1. Отправляется `aceess_token`
1. При ошибке сервис останавливается
1. При успешной авторизации выполняется команда get_states
1. Обрабатывается результат get_states
1. Создается триггер изменения состояния нужных entity
1. При получении события триггера запускается обработчик изменения состояния по entity_id

Все сообщения, полученные от WebSocketAPI сначала добаавляются в очередь и потом обрабатываются в порядке поступления в отдельном потоке.
Таким образом получается минимальная задержка получения сообщений.

## Пример использования

Пример использования можно посмотреть тут - проект [HASSIO Add-on управления подсветкой для Mini PC T9 Plus](https://github.com/ETCDema/HASSIO.Addon.T9PlusLED).